<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>菲洛图 - felotus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app">

        <!-- 顶栏 -->
        <header class="top-bar">
            <!-- !!! 修改 1: 把 div 变成 router-link 来触发侧边栏路由 !!! -->
            <router-link to="/sidebar" class="top-bar-left" tag="div">
                <img src="https://i.postimg.cc/Yq19VCkN/afelotus.jpg" alt="avatar" class="avatar">
                <span class="name">felotus</span>
            </router-link>
            <div class="top-bar-right">
                <router-link to="/global-search"><i class="icon fas fa-search"></i></router-link>
                <router-link to="/add-character"><i class="icon fas fa-plus"></i></router-link>
            </div>
        </header>

        <!-- !!! 修改 2: v-if 和 @click 的逻辑都变了 !!! -->
        <!-- 遮罩层现在由路由决定是否显示，点击时执行路由返回 -->
        <div class="sidebar-backdrop" v-if="isSidebarRouteActive" @click="$router.back()"></div>

        <!-- 侧边栏 -->
        <aside 
            class="sidebar" 
            <!-- !!! 修改 3: class 绑定计算属性，不再是 isSidebarOpen !!! -->
            :class="{ open: isSidebarRouteActive }"
            @touchstart="handleTouchStart"
            @touchmove="handleTouchMove"
            @touchend="handleTouchEnd"
        >
            <!-- 顶部六个图标 -->
            <div class="sidebar-top-actions">
                <router-link to="/anniversary" class="action-item"><i class="icon fas fa-calendar-day"></i></router-link>
                <router-link to="/favorites" class="action-item"><i class="icon fas fa-star"></i></router-link>
                <router-link to="/inbox" class="action-item"><i class="icon fas fa-envelope"></i></router-link>
                <router-link to="/announcements" class="action-item"><i class="icon fas fa-bullhorn"></i></router-link>
                <router-link to="/help" class="action-item"><i class="icon fas fa-question-circle"></i></router-link>
                <!-- !!! 修改 4: 关闭按钮也改成路由返回 !!! -->
                <div class="action-item" @click="$router.back()"><i class="icon fas fa-arrow-right close-btn"></i></div>
            </div>

            <!-- 可滚动区域 -->
            <div class="sidebar-scroll-container">
                <!-- 用户区 -->
                <div class="sidebar-user-area">
                    <img src="https://i.postimg.cc/Yq19VCkN/afelotus.jpg" alt="avatar" class="sidebar-avatar">
                    <div class="user-info">
                        <div class="sidebar-name">felotus</div>
                        <div class="sidebar-email">your.email@example.com</div>
                    </div>
                    <router-link to="/profile"><i class="icon fas fa-pen edit-profile-icon"></i></router-link>
                </div>

                <!-- 内容区 -->
                <nav class="sidebar-content-area nav-list">
                    <ul>
                        <li><router-link to="/personalization"><i class="nav-icon fas fa-palette fa-fw"></i><span>个性化</span></router-link></li>
                        <li><router-link to="/roles"><i class="nav-icon fas fa-user-tag fa-fw"></i><span>角色</span></router-link></li>
                    </ul>
                    <hr>
                    <ul>
                        <li><router-link to="/api"><i class="nav-icon fas fa-plug fa-fw"></i><span>API</span></router-link></li>
                        <li><router-link to="/search"><i class="nav-icon fas fa-globe fa-fw"></i><span>搜索服务</span></router-link></li>
                        <!-- !!! 修改 5: 更换语音服务图标 !!! -->
                        <li><router-link to="/voice"><i class="nav-icon fas fa-play-circle fa-fw"></i><span>语音服务</span></router-link></li>
                        <li><router-link to="/regex"><i class="nav-icon fas fa-file-code fa-fw"></i><span>正则</span></router-link></li>
                        <li><router-link to="/shortcuts"><i class="nav-icon fas fa-bolt fa-fw"></i><span>快捷键</span></router-link></li>
                    </ul>
                    <hr>
                    <ul>
                        <li><router-link to="/data"><i class="nav-icon fas fa-database fa-fw"></i><span>数据管理</span></router-link></li>
                        <li><router-link to="/report"><i class="nav-icon fas fa-chart-pie fa-fw"></i><span>年度报告</span></router-link></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- 主内容区域 -->
        <main 
            class="main-content"
            @touchstart="handleMainTouchStart"
            @touchmove="handleMainTouchMove"
            @touchend="handleMainTouchEnd"
        >
            <router-view></router-view>
        </main>

    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="main.js"></script>

</body>
</html>